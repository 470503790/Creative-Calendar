# ED01 — 编辑器架构重构：Scene/Renderer/Command 分层

> **阶段**：前端（uni-app · Vue3 + TS · mp-weixin） · **数据**：Mock  
> **规范**：结合《创意日历 App 全套界面与产品规范 V1》（画布最新版）

## 目标（Goal）
- 拆分 Scene（数据）、Renderer（渲染）、Command（命令/撤销），消除耦合，为后续功能奠基。

## 修改范围（Scope）
- 新增：`src/editor/core/{scene.ts,renderer.ts,commands.ts}`、`src/editor/utils/{ids.ts,geometry.ts}`
- Store 仅保留 `scene` 与 `uiState`

## 实施步骤（How to）
1) 设计 `Scene` 类型：Project→Page[]→Layer[]（基础 layer：calendar/text/shape/image/sticker）。
2) `Renderer` 输入 `Scene + viewport`，暴露 `render()/hitTest()/getBounds()`。
3) `CommandBus`：`execute/undo/redo`；命令粒度：新增/更新/删除/重排/分组。
4) 将现有编辑器页面改为依赖 Store + Renderer。

## 验收标准（Definition of Done）
- [ ] 架构文件落位；无循环依赖
- [ ] 单测覆盖 `add/update/reorder` 的撤销/重做
- [ ] 空白场景渲染无报错

## 测试方案（Testing）
- Vitest：命令可撤销/重做；id 唯一
- 手测：新增→撤销→重做链路

## 风险与回滚（Risks & Rollback）
- 迁移期 break change → 添加适配层逐步替换

## 估时与负责人（Estimate & Owner）
- 估时：1.5d
- 负责人：@待指派
