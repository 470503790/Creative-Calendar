# R1 — 页面路由审计与自动修复脚本

> **阶段**：前端优先（uni-app, Vue3 + TS, mp-weixin） · **数据**：Mock  
> **规范**：参考《创意日历 App 全套界面与产品规范 V1》（最新）

## 目标（Goal）
- 自动找出 **未在 `pages.json` 注册的页面** 与 **孤儿页面**，并给出修复建议或一键修复。

## 修改范围（Scope）
- 新增 `tools/route-audit.mjs`（Node 脚本）
- 新增 npm 脚本：`audit:routes`、`fix:routes`
- 变更：`pages.json`（按脚本建议增删改）

## 输入与依赖（Inputs & Dependencies）
- 输入：当前仓库目录结构、`pages.json`
- 依赖：A1/A2 已完成的基本骨架

## 输出（Deliverables）
- 审计报告（终端输出 + 生成 `reports/route-audit.json`）
- 可选自动修复（新增缺失路由/移除不存在页面/统一 path 格式）

## 实施步骤（How to）
1. 创建 `tools/route-audit.mjs`：
   - 读取 `pages.json` 的 `{ pages[].path }` 列表；扫描 `pages/**/index.vue` 实际存在页面。
   - 产出三类清单：**未注册**（存在于目录但未在 pages.json）、**注册缺失**（在 pages.json 但物理不存在）、**重复/冲突**（同名 path 或大小写冲突）。
   - 可选参数 `--fix`：自动补全未注册页面（默认 `navigationBarTitleText` 为目录名），移除丢失项，统一为 `pages/xxx/index` 形式。
2. 在 `package.json` 增加：
```json
{ "scripts": { "audit:routes":"node tools/route-audit.mjs", "fix:routes":"node tools/route-audit.mjs --fix" } }
```
3. 运行 `pnpm audit:routes` 产出 `reports/route-audit.json` 并随 PR 提交。


## 验收标准（Definition of Done）
- [ ] 运行脚本可列出三类问题并生成报告
- [ ] `fix:routes` 能在备份原文件后完成自动修复
- [ ] PR 内附报告与修复前后 diff 截图

## 测试方案（Testing）
- 人为新增一个未注册页面，验证审计能命中
- 人为在 `pages.json` 添加一个不存在的路径，验证脚本能发现

## 风险与回滚（Risks & Rollback）
- 自动修复误删：在脚本中对 `pages.json` 自动备份到 `pages.backup.json`；仅对 pages 节点改动

## 估时与负责人（Estimate & Owner）
- 估时：0.5d
- 负责人：@待指派
